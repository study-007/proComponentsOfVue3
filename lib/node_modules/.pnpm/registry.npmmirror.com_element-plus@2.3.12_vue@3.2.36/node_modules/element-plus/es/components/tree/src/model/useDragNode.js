"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const b=require("vue"),B=require("../../../../hooks/use-namespace/index.js"),p=require("../../../../utils/dom/style.js"),h=Symbol("dragEvents");function x({props:u,ctx:f,el$:T,dropIndicator$:$,store:C}){const g=B.useNamespace("tree"),d=b.ref({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null}),S=({event:r,treeNode:t})=>{if(typeof u.allowDrag=="function"&&!u.allowDrag(t.node))return r.preventDefault(),!1;r.dataTransfer.effectAllowed="move";try{r.dataTransfer.setData("text/plain","")}catch{}d.value.draggingNode=t,f.emit("node-drag-start",t.node,r)},I=({event:r,treeNode:t})=>{const e=t,o=d.value.dropNode;o&&o.node.id!==e.node.id&&p.removeClass(o.$el,g.is("drop-inner"));const n=d.value.draggingNode;if(!n||!e)return;let i=!0,l=!0,s=!0,m=!0;typeof u.allowDrop=="function"&&(i=u.allowDrop(n.node,e.node,"prev"),m=l=u.allowDrop(n.node,e.node,"inner"),s=u.allowDrop(n.node,e.node,"next")),r.dataTransfer.dropEffect=l||i||s?"move":"none",(i||l||s)&&(o==null?void 0:o.node.id)!==e.node.id&&(o&&f.emit("node-drag-leave",n.node,o.node,r),f.emit("node-drag-enter",n.node,e.node,r)),(i||l||s)&&(d.value.dropNode=e),e.node.nextSibling===n.node&&(s=!1),e.node.previousSibling===n.node&&(i=!1),e.node.contains(n.node,!1)&&(l=!1),(n.node===e.node||n.node.contains(e.node))&&(i=!1,l=!1,s=!1);const c=e.$el.querySelector(`.${g.be("node","content")}`).getBoundingClientRect(),v=T.value.getBoundingClientRect();let a;const E=i?l?.25:s?.45:1:-1,q=s?l?.75:i?.55:0:1;let D=-9999;const y=r.clientY-c.top;y<c.height*E?a="before":y>c.height*q?a="after":l?a="inner":a="none";const N=e.$el.querySelector(`.${g.be("node","expand-icon")}`).getBoundingClientRect(),w=$.value;a==="before"?D=N.top-v.top:a==="after"&&(D=N.bottom-v.top),w.style.top=`${D}px`,w.style.left=`${N.right-v.left}px`,a==="inner"?p.addClass(e.$el,g.is("drop-inner")):p.removeClass(e.$el,g.is("drop-inner")),d.value.showDropIndicator=a==="before"||a==="after",d.value.allowDrop=d.value.showDropIndicator||m,d.value.dropType=a,f.emit("node-drag-over",n.node,e.node,r)},P=r=>{const{draggingNode:t,dropType:e,dropNode:o}=d.value;if(r.preventDefault(),r.dataTransfer.dropEffect="move",t&&o){const n={data:t.node.data};e!=="none"&&t.node.remove(),e==="before"?o.node.parent.insertBefore(n,o.node):e==="after"?o.node.parent.insertAfter(n,o.node):e==="inner"&&o.node.insertChild(n),e!=="none"&&C.value.registerNode(n),p.removeClass(o.$el,g.is("drop-inner")),f.emit("node-drag-end",t.node,o.node,e,r),e!=="none"&&f.emit("node-drop",t.node,o.node,e,r)}t&&!o&&f.emit("node-drag-end",t.node,null,e,r),d.value.showDropIndicator=!1,d.value.draggingNode=null,d.value.dropNode=null,d.value.allowDrop=!0};return b.provide(h,{treeNodeDragStart:S,treeNodeDragOver:I,treeNodeDragEnd:P}),{dragState:d}}exports.dragEventsKey=h;exports.useDragNodeHandler=x;

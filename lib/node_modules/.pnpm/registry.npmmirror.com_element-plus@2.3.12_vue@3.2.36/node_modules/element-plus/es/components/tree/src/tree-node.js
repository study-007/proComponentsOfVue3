"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const n=require("vue"),N=require("../../../../../../../registry.npmmirror.com_@vue_shared@3.3.4/node_modules/@vue/shared/dist/shared.esm-bundler.js"),S=require("../../collapse-transition/index.js"),K=require("../../checkbox/index.js"),M=require("../../icon/index.js"),b=require("../../../../../../../registry.npmmirror.com_@element-plus_icons-vue@2.1.0_vue@3.2.36/node_modules/@element-plus/icons-vue/dist/index.js"),$=require("./tree-node-content.js"),E=require("./model/util.js"),O=require("./model/useNodeExpandEventBroadcast.js"),V=require("./model/useDragNode.js"),T=require("./model/node.js"),I=require("../../../_virtual/plugin-vue_export-helper.js"),L=require("../../../hooks/use-namespace/index.js"),R=require("../../../utils/error.js"),z=n.defineComponent({name:"ElTreeNode",components:{ElCollapseTransition:S.default,ElCheckbox:K.ElCheckbox,NodeContent:$.default,ElIcon:M.ElIcon,Loading:b.Loading},props:{node:{type:T.default,default:()=>({})},props:{type:Object,default:()=>({})},accordion:Boolean,renderContent:Function,renderAfterExpand:Boolean,showCheckbox:{type:Boolean,default:!1}},emits:["node-expand"],setup(e,a){const k=L.useNamespace("tree"),{broadcastExpanded:f}=O.useNodeExpandEventBroadcast(e),d=n.inject("RootTree"),c=n.ref(!1),s=n.ref(!1),u=n.ref(null),h=n.ref(null),C=n.ref(null),p=n.inject(V.dragEventsKey),i=n.getCurrentInstance();n.provide("NodeInstance",i),d||R.debugWarn("Tree","Can not find node's tree."),e.node.expanded&&(c.value=!0,s.value=!0);const t=d.props.props.children||"children";n.watch(()=>{const o=e.node.data[t];return o&&[...o]},()=>{e.node.updateChildren()}),n.watch(()=>e.node.indeterminate,o=>{g(e.node.checked,o)}),n.watch(()=>e.node.checked,o=>{g(o,e.node.indeterminate)}),n.watch(()=>e.node.expanded,o=>{n.nextTick(()=>c.value=o),o&&(s.value=!0)});const D=o=>E.getNodeKey(d.props.nodeKey,o.data),y=o=>{const r=e.props.class;if(!r)return{};let l;if(N.isFunction(r)){const{data:q}=o;l=r(q,o)}else l=r;return N.isString(l)?{[l]:!0}:l},g=(o,r)=>{(u.value!==o||h.value!==r)&&d.ctx.emit("check-change",e.node.data,o,r),u.value=o,h.value=r},w=o=>{E.handleCurrentChange(d.store,d.ctx.emit,()=>d.store.value.setCurrentNode(e.node)),d.currentNode.value=e.node,d.props.expandOnClickNode&&m(),d.props.checkOnClickNode&&!e.node.disabled&&v(null,{target:{checked:!e.node.checked}}),d.ctx.emit("node-click",e.node.data,e.node,i,o)},B=o=>{d.instance.vnode.props.onNodeContextmenu&&(o.stopPropagation(),o.preventDefault()),d.ctx.emit("node-contextmenu",o,e.node.data,e.node,i)},m=()=>{e.node.isLeaf||(c.value?(d.ctx.emit("node-collapse",e.node.data,e.node,i),e.node.collapse()):(e.node.expand(),a.emit("node-expand",e.node.data,e.node,i)))},v=(o,r)=>{e.node.setChecked(r.target.checked,!d.props.checkStrictly),n.nextTick(()=>{const l=d.store.value;d.ctx.emit("check",e.node.data,{checkedNodes:l.getCheckedNodes(),checkedKeys:l.getCheckedKeys(),halfCheckedNodes:l.getHalfCheckedNodes(),halfCheckedKeys:l.getHalfCheckedKeys()})})};return{ns:k,node$:C,tree:d,expanded:c,childNodeRendered:s,oldChecked:u,oldIndeterminate:h,getNodeKey:D,getNodeClass:y,handleSelectChange:g,handleClick:w,handleContextMenu:B,handleExpandIconClick:m,handleCheckChange:v,handleChildNodeExpand:(o,r,l)=>{f(r),d.ctx.emit("node-expand",o,r,l)},handleDragStart:o=>{d.props.draggable&&p.treeNodeDragStart({event:o,treeNode:e})},handleDragOver:o=>{o.preventDefault(),d.props.draggable&&p.treeNodeDragOver({event:o,treeNode:{$el:C.value,node:e.node}})},handleDrop:o=>{o.preventDefault()},handleDragEnd:o=>{d.props.draggable&&p.treeNodeDragEnd(o)},CaretRight:b.CaretRight}}}),j=["aria-expanded","aria-disabled","aria-checked","draggable","data-key"],F=["aria-expanded"];function A(e,a,k,f,d,c){const s=n.resolveComponent("el-icon"),u=n.resolveComponent("el-checkbox"),h=n.resolveComponent("loading"),C=n.resolveComponent("node-content"),p=n.resolveComponent("el-tree-node"),i=n.resolveComponent("el-collapse-transition");return n.withDirectives((n.openBlock(),n.createElementBlock("div",{ref:"node$",class:n.normalizeClass([e.ns.b("node"),e.ns.is("expanded",e.expanded),e.ns.is("current",e.node.isCurrent),e.ns.is("hidden",!e.node.visible),e.ns.is("focusable",!e.node.disabled),e.ns.is("checked",!e.node.disabled&&e.node.checked),e.getNodeClass(e.node)]),role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.node.disabled,"aria-checked":e.node.checked,draggable:e.tree.props.draggable,"data-key":e.getNodeKey(e.node),onClick:a[1]||(a[1]=n.withModifiers((...t)=>e.handleClick&&e.handleClick(...t),["stop"])),onContextmenu:a[2]||(a[2]=(...t)=>e.handleContextMenu&&e.handleContextMenu(...t)),onDragstart:a[3]||(a[3]=n.withModifiers((...t)=>e.handleDragStart&&e.handleDragStart(...t),["stop"])),onDragover:a[4]||(a[4]=n.withModifiers((...t)=>e.handleDragOver&&e.handleDragOver(...t),["stop"])),onDragend:a[5]||(a[5]=n.withModifiers((...t)=>e.handleDragEnd&&e.handleDragEnd(...t),["stop"])),onDrop:a[6]||(a[6]=n.withModifiers((...t)=>e.handleDrop&&e.handleDrop(...t),["stop"]))},[n.createElementVNode("div",{class:n.normalizeClass(e.ns.be("node","content")),style:n.normalizeStyle({paddingLeft:(e.node.level-1)*e.tree.props.indent+"px"})},[e.tree.props.icon||e.CaretRight?(n.openBlock(),n.createBlock(s,{key:0,class:n.normalizeClass([e.ns.be("node","expand-icon"),e.ns.is("leaf",e.node.isLeaf),{expanded:!e.node.isLeaf&&e.expanded}]),onClick:n.withModifiers(e.handleExpandIconClick,["stop"])},{default:n.withCtx(()=>[(n.openBlock(),n.createBlock(n.resolveDynamicComponent(e.tree.props.icon||e.CaretRight)))]),_:1},8,["class","onClick"])):n.createCommentVNode("v-if",!0),e.showCheckbox?(n.openBlock(),n.createBlock(u,{key:1,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:!!e.node.disabled,onClick:a[0]||(a[0]=n.withModifiers(()=>{},["stop"])),onChange:e.handleCheckChange},null,8,["model-value","indeterminate","disabled","onChange"])):n.createCommentVNode("v-if",!0),e.node.loading?(n.openBlock(),n.createBlock(s,{key:2,class:n.normalizeClass([e.ns.be("node","loading-icon"),e.ns.is("loading")])},{default:n.withCtx(()=>[n.createVNode(h)]),_:1},8,["class"])):n.createCommentVNode("v-if",!0),n.createVNode(C,{node:e.node,"render-content":e.renderContent},null,8,["node","render-content"])],6),n.createVNode(i,null,{default:n.withCtx(()=>[!e.renderAfterExpand||e.childNodeRendered?n.withDirectives((n.openBlock(),n.createElementBlock("div",{key:0,class:n.normalizeClass(e.ns.be("node","children")),role:"group","aria-expanded":e.expanded},[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(e.node.childNodes,t=>(n.openBlock(),n.createBlock(p,{key:e.getNodeKey(t),"render-content":e.renderContent,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,node:t,accordion:e.accordion,props:e.props,onNodeExpand:e.handleChildNodeExpand},null,8,["render-content","render-after-expand","show-checkbox","node","accordion","props","onNodeExpand"]))),128))],10,F)),[[n.vShow,e.expanded]]):n.createCommentVNode("v-if",!0)]),_:1})],42,j)),[[n.vShow,e.node.visible]])}var H=I.default(z,[["render",A],["__file","/home/runner/work/element-plus/element-plus/packages/components/tree/src/tree-node.vue"]]);exports.default=H;
